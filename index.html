<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏™‡πà‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: url('https://images.dmc.tv/wallpaper/raw/14180.jpg') center/cover no-repeat;
            touch-action: manipulation;
        }
        .navbar {
            width: 100%;
            background-color: #333;
            padding: 1.5% 2%;
            position: fixed;
            top: 0;
            left: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }
        .navbar a {
            color: white;
            text-decoration: none;
            padding: 1% 2%;
            font-size: clamp(16px, 2.5vw, 20px);
        }
        .navbar a:hover, .navbar a:active {
            background-color: #555;
        }
        .navbar .right-links {
            display: flex;
            align-items: center;
        }
        .navbar .right-links a {
            margin-left: 15px;
        }
        .card-container {
            perspective: 1000px;
            width: 80vw;
            height: 60vh;
            max-width: 800px;
            max-height: 1000px;
            position: relative;
            margin: 12vh auto 5vh;
        }
        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 0.8s ease;
        }
        .card.flipped {
            transform: rotateY(180deg);
        }
        .front, .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .front {
            background: url('image/default.jpg') center/contain no-repeat !important;
            background-size: contain !important;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5%;
            color: white;
            text-shadow: 0 0 5px rgba(0,0,0,0.8);
        }
        .front h2 {
            align-self: flex-end;
        }
        .front .festival-message {
            font-size: clamp(18px, 3.5vw, 24px);
            text-align: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 12px;
            border-radius: 10px;
        }
        .back {
            background-color: white;
            transform: rotateY(180deg);
            padding: 5%;
            text-align: center;
        }
        .front h2, .back h3 {
            font-size: clamp(20px, 3.5vw, 26px);
            margin-bottom: 2%;
        }
        select, input, textarea {
            margin: 2% 0;
            padding: 2.5%;
            width: 90%;
            font-size: clamp(14px, 2.5vw, 18px);
        }
        textarea {
            resize: none;
            height: 100px;
        }
        button {
            padding: 4% 8%;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(16px, 3vw, 20px);
            min-height: 50px;
            min-width: 120px;
            margin: 1%;
            transition: background-color 0.2s ease;
        }
        button:hover, button:active {
            background-color: #45a049;
        }
        footer {
            width: 100%;
            background-color: #333;
            color: white;
            text-align: center;
            padding: 1.5% 0;
            font-size: clamp(14px, 2vw, 18px);
        }
        .progress-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .progress-bar-container {
            width: 400px;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        .progress-bar {
            height: 40px;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.1s linear;
            text-align: center;
            line-height: 40px;
            color: white;
            font-weight: bold;
            font-size: clamp(14px, 2vw, 18px);
        }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1001;
            text-align: center;
            max-width: 90%;
            white-space: pre-wrap;
        }
        .popup button {
            margin-top: 15px;
            padding: 12px 24px;
            min-width: 100px;
            font-size: clamp(16px, 3vw, 20px);
        }
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .image-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1001;
            text-align: center;
            width: 450px;
            max-width: 90%;
        }
        .image-popup h3 {
            margin-bottom: 20px;
            font-size: clamp(18px, 3vw, 22px);
        }
        .image-popup select, .image-popup input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            font-size: clamp(14px, 2.5vw, 18px);
        }
        .image-popup .button-group {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .image-popup button {
            width: 48%;
            padding: 15px;
            font-size: clamp(16px, 3vw, 20px);
            min-height: 50px;
        }
        .image-popup .close-btn {
            background-color: #f44336;
        }
        .image-popup .close-btn:hover, .image-popup .close-btn:active {
            background-color: #d32f2f;
        }
        .image-preview {
            margin: 15px 0;
            text-align: center;
        }
        .image-preview img {
            max-width: 150px;
            max-height: 150px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .image-preview p {
            color: #666;
            font-size: clamp(12px, 2vw, 16px);
        }
        .datetime {
            color: white;
            font-size: clamp(14px, 2vw, 18px);
            padding: 1% 2%;
        }
        #customMessage {
            display: none;
        }
        /* Media Queries ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö iPad Air */
        @media (max-width: 1640px) {
            .card-container {
                width: 85vw;
                height: 65vh;
                max-width: 750px;
                max-height: 950px;
            }
            .navbar {
                padding: 2% 3%;
            }
            .navbar a {
                font-size: clamp(15px, 2.2vw, 19px);
            }
            .front .festival-message {
                font-size: clamp(17px, 3.2vw, 22px);
            }
            .front h2, .back h3 {
                font-size: clamp(19px, 3.2vw, 24px);
            }
            select, input, textarea {
                font-size: clamp(13px, 2.2vw, 17px);
            }
            button {
                font-size: clamp(15px, 2.8vw, 19px);
                padding: 3.5% 7%;
            }
            .image-popup {
                width: 420px;
            }
            .image-popup button {
                font-size: clamp(15px, 2.8vw, 19px);
                padding: 12px;
            }
        }
        @media (max-width: 1180px) {
            .card-container {
                width: 90vw;
                height: 70vh;
                max-width: 700px;
                max-height: 900px;
            }
            .image-popup {
                width: 380px;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="datetime" id="datetime"></div>
        <div class="right-links">
            <a href="#" id="imagePopupLink"><i class="fas fa-image"></i></a>
            <a href="settings.html"><i class="fas fa-cog"></i></a>
        </div>
    </div>

    <div class="card-container">
        <div class="card" id="card">
            <div class="front" id="cardFront">
                <div class="festival-message" id="festivalMessage"></div>
                <div>
                    <h2>‡∏™‡πà‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à</h2>
                    <button id="flipButton">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</button>
                </div>
            </div>
            <div class="back">
                <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</h3>
                <select id="messageType" onchange="updateBlessingOptions()">
                    <option value="festival">‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏ï‡∏≤‡∏°‡πÄ‡∏ó‡∏®‡∏Å‡∏≤‡∏•</option>
                    <option value="encouragement">‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à</option>
                    <option value="birthday">‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</option>
                    <option value="buddhist">‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞</option>
                </select>
                <select id="blessing" onchange="toggleCustomMessage()">
                    <option value="1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1</option>
                    <option value="2">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 2</option>
                    <option value="3">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 3</option>
                    <option value="custom">‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á</option>
                </select>
                <textarea id="customMessage" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"></textarea>
                <input type="text" id="firstName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
                <input type="text" id="lastName" placeholder="‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡∏´‡∏£‡∏∑‡∏≠ -">
                <button onclick="submitBlessing()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á</button>
            </div>
        </div>
    </div>
    <footer>
        <p>¬© 2025 ‡∏™‡πà‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à | ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏ô‡∏¥‡∏î ‡∏®‡∏¥‡∏©‡∏¢‡πå‡∏´‡∏•‡∏ß‡∏á‡∏û‡πà‡∏≠‡πÄ‡∏™‡∏∑‡∏≠ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏õ‡πÅ‡∏Å‡∏£‡∏°‡πÇ‡∏î‡∏¢ xAI</p>
    </footer>

    <div class="progress-overlay" id="progressOverlay">
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar">0%</div>
        </div>
    </div>

    <div class="popup-overlay" id="popupOverlay"></div>
    <div class="popup" id="popup">
        <p id="popupMessage"></p>
        <button onclick="hidePopup()">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>

    <div class="popup-overlay" id="imagePopupOverlay"></div>
    <div class="image-popup" id="imagePopup">
        <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h3>
        <select id="imageSelect" onchange="updateImagePreview()">
            <!-- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏î‡∏¢ JavaScript -->
        </select>
        <input type="file" id="imageFile" accept="image/*">
        <div class="image-preview" id="imagePreview">
            <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</p>
        </div>
        <div class="button-group">
            <button id="confirmImageButton">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            <button class="close-btn" onclick="hideImagePopup()">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>

    <script>
        let currentImageUrl = localStorage.getItem('currentImage') || 'image/default.jpg';

        const availableImages = [
            { value: 'image/default.jpg', text: '‡∏†‡∏≤‡∏û‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô' },
            { value: 'image/family_day.jpg', text: '‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß' },
            { value: 'image/new_year.jpg', text: '‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà' },
            { value: 'image/songkran.jpg', text: '‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå' },
            { value: 'image/christmas.jpg', text: '‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™' },
            { value: 'image/loy_krathong.jpg', text: '‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á' },
            { value: 'image/buddhist_day.jpg', text: '‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞' },
            { value: 'image/chinese_new_year.jpg', text: '‡∏ï‡∏£‡∏∏‡∏©‡∏à‡∏µ‡∏ô' },
            { value: 'image/valentine.jpg', text: '‡∏ß‡∏≤‡πÄ‡∏•‡∏ô‡πÑ‡∏ó‡∏ô‡πå' },
            { value: 'image/makha_bucha.jpg', text: '‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤' }
        ];

        const festivalImages = {
            '04-14': { alt: '‡∏†‡∏≤‡∏û‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß', message: '‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß' },
            '01-01': { alt: '‡∏†‡∏≤‡∏û‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡πÑ‡∏ü‡πÄ‡∏â‡∏•‡∏¥‡∏°‡∏â‡∏•‡∏≠‡∏á‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà', message: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà' },
            '04-13': { alt: '‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏î‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', message: '‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå' },
            '04-14-songkran': { alt: '‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏î‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', message: '‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå' },
            '04-15': { alt: '‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏î‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå', message: '‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå' },
            '12-25': { alt: '‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç', message: '‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™' },
            '11-12': { alt: '‡∏†‡∏≤‡∏û‡∏Å‡∏£‡∏∞‡∏ó‡∏á‡∏•‡∏≠‡∏¢‡πÉ‡∏ô‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏°‡∏Ñ‡πà‡∏≥‡∏Ñ‡∏∑‡∏ô', message: '‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á' },
            '01-29': { alt: '‡∏†‡∏≤‡∏û‡πÇ‡∏Ñ‡∏°‡πÅ‡∏î‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ï‡∏£‡∏∏‡∏©‡∏à‡∏µ‡∏ô', message: '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏ß‡∏±‡∏ô‡∏ï‡∏£‡∏∏‡∏©‡∏à‡∏µ‡∏ô' },
            '02-14': { alt: '‡∏†‡∏≤‡∏û‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏î‡∏≠‡∏Å‡∏Å‡∏∏‡∏´‡∏•‡∏≤‡∏ö‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ß‡∏≤‡πÄ‡∏•‡∏ô‡πÑ‡∏ó‡∏ô‡πå', message: '‡∏£‡∏±‡∏Å‡∏´‡∏ß‡∏≤‡∏ô‡∏â‡πà‡∏≥‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ß‡∏≤‡πÄ‡∏•‡∏ô‡πÑ‡∏ó‡∏ô‡πå' },
            '02-12': { alt: '‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏û‡∏¥‡∏ò‡∏µ‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤', message: '‡∏ß‡∏±‡∏ô‡∏°‡∏≤‡∏Ü‡∏ö‡∏π‡∏ä‡∏≤ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏™‡∏á‡∏ö' },
            'buddhist': { alt: '‡∏†‡∏≤‡∏û‡∏û‡∏£‡∏∞‡∏û‡∏∏‡∏ó‡∏ò‡∏£‡∏π‡∏õ‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞', message: '‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏ú‡πà‡∏≠‡∏á‡πÉ‡∏™' }
        };

        const buddhistDays = [
            '2025-01-06', '2025-01-13', '2025-01-20', '2025-01-27',
            '2025-02-05', '2025-02-12', '2025-02-19', '2025-02-26',
            '2025-03-06', '2025-03-13', '2025-03-20', '2025-03-27',
            '2025-04-04', '2025-04-11', '2025-04-18', '2025-04-25'
        ];

        const blessingOptions = {
            festival: [
                { value: "1", text: "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏ï‡∏•‡∏≠‡∏î‡∏õ‡∏µ" },
                { value: "2", text: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏™‡∏á‡∏Å‡∏£‡∏≤‡∏ô‡∏ï‡πå ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏î‡∏ä‡∏∑‡πà‡∏ô‡∏£‡∏∑‡πà‡∏ô‡πÄ‡∏£‡∏¥‡∏á" },
                { value: "3", text: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡πå‡∏°‡∏≤‡∏™ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏ö‡πÅ‡∏ï‡πà‡∏™‡∏¥‡πà‡∏á‡∏î‡∏µ‡πÜ" },
                { value: "4", text: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏•‡∏≠‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏á ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏£‡∏≤‡∏ö‡∏£‡∏∑‡πà‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏µ‡πà‡∏¢‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á" },
                { value: "5", text: "‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞‡∏ô‡∏µ‡πâ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏ú‡πà‡∏≠‡∏á‡πÉ‡∏™ ‡∏°‡∏µ‡∏™‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏û‡∏ö‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏™‡∏á‡∏ö" },
                { value: "custom", text: "‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á" }
            ],
            encouragement: [
                { value: "1", text: "‡∏™‡∏π‡πâ‡πÜ ‡∏ô‡∏∞ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏û‡πâ‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ" },
                { value: "2", text: "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡∏ó‡∏µ‡πà‡∏î‡∏µ‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡πÜ ‡∏ß‡∏±‡∏ô" },
                { value: "3", text: "‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡πÑ‡∏î‡πâ! ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏£‡∏∞Succes‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à" },
                { value: "custom", text: "‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á" }
            ],
            birthday: [
                { value: "1", text: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á ‡πÅ‡∏•‡∏∞‡∏™‡∏°‡∏´‡∏ß‡∏±‡∏á‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏£" },
                { value: "2", text: "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏µ‡∏ô‡∏µ‡πâ‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏°‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡∏ï‡∏•‡∏≠‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ" },
                { value: "3", text: "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏ö‡πÄ‡∏à‡∏≠‡πÅ‡∏ï‡πà‡∏™‡∏¥‡πà‡∏á‡∏î‡∏µ‡πÜ ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏ó‡∏≤‡∏á" },
                { value: "custom", text: "‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á" }
            ],
            buddhist: [
                { value: "1", text: "‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞‡∏ô‡∏µ‡πâ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏à‡∏¥‡∏ï‡πÉ‡∏à‡∏™‡∏á‡∏ö ‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏õ‡∏±‡∏ç‡∏ç‡∏≤" },
                { value: "2", text: "‚Äò‡∏Ç‡∏¢‡∏≤‡∏ô‡∏∞‡∏ß‡∏≤ ‡∏≠‡∏õ‡∏∫‡∏õ‡∏°‡∏≤‡πÇ‡∏ó ‡∏≠‡∏°‡∏ï‡πç ‡∏õ‡∏ó‡πç‚Äô ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ó‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏π‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏ï‡∏≤‡∏¢ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏™‡∏ï‡∏¥‡πÉ‡∏ô‡∏ó‡∏∏‡∏Å‡∏¢‡πà‡∏≤‡∏á‡∏Å‡πâ‡∏≤‡∏ß" },
                { value: "3", text: "‚Äò‡∏™‡∏û‡∏∫‡∏û‡πç ‡∏ó‡∏≤‡∏ô‡πç ‡∏ò‡∏°‡∏∫‡∏°‡∏ó‡∏≤‡∏ô‡πç ‡∏ä‡∏¥‡∏ô‡∏≤‡∏ï‡∏¥‚Äô ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ò‡∏£‡∏£‡∏°‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏ô‡∏¢‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏ç‡πà ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏°‡∏ï‡∏ï‡∏≤" },
                { value: "4", text: "‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∞‡∏ô‡∏µ‡πâ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏®‡∏µ‡∏• ‡∏ù‡∏∂‡∏Å‡∏à‡∏¥‡∏ï‡πÉ‡∏´‡πâ‡∏ú‡πà‡∏≠‡∏á‡πÉ‡∏™ ‡πÅ‡∏•‡∏∞‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ó" },
                { value: "custom", text: "‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏≠‡∏á" }
            ]
        };

        function updateFestivalMessage() {
            try {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const dateKey = `${month}-${day}`;
                const dateStr = `${year}-${month}-${day}`;
                const festivalMessage = document.getElementById('festivalMessage');

                if (buddhistDays.includes(dateStr)) {
                    festivalMessage.textContent = festivalImages['buddhist'].message;
                    return;
                }

                if (festivalImages[dateKey]) {
                    festivalMessage.textContent = festivalImages[dateKey].message;
                } else if (dateKey === '04-14') {
                    festivalMessage.textContent = festivalImages['04-14'].message;
                } else {
                    festivalMessage.textContent = '';
                }
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô updateFestivalMessage:', error);
            }
        }

        function updateCardImage() {
            try {
                const cardFront = document.getElementById('cardFront');
                cardFront.style.background = 'none';
                const img = new Image();
                img.src = currentImageUrl;
                img.onload = () => {
                    cardFront.style.background = `url('${currentImageUrl}') center/contain no-repeat`;
                    cardFront.style.backgroundSize = 'contain';
                };
                img.onerror = () => {
                    cardFront.style.background = `url('image/default.jpg') center/contain no-repeat`;
                    cardFront.style.backgroundSize = 'contain';
                    currentImageUrl = 'image/default.jpg';
                    localStorage.setItem('currentImage', currentImageUrl);
                    console.warn('‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏û‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ó‡∏ô');
                };
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô updateCardImage:', error);
            }
        }

        try {
            updateCardImage();
            updateFestivalMessage();
        } catch (error) {
            console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô:', error);
        }

        function updateBlessingOptions() {
            try {
                const messageType = document.getElementById('messageType').value;
                const blessingSelect = document.getElementById('blessing');
                blessingSelect.innerHTML = '';
                const options = blessingOptions[messageType];
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option.value;
                    opt.textContent = option.text;
                    blessingSelect.appendChild(opt);
                });
                toggleCustomMessage();
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô updateBlessingOptions:', error);
            }
        }

        function toggleCustomMessage() {
            try {
                const blessingSelect = document.getElementById('blessing');
                const customMessage = document.getElementById('customMessage');
                customMessage.style.display = blessingSelect.value === 'custom' ? 'block' : 'none';
                if (blessingSelect.value !== 'custom') {
                    customMessage.value = '';
                }
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô toggleCustomMessage:', error);
            }
        }

        function updateDateTime() {
            try {
                const now = new Date();
                const options = {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                };
                const dateTimeString = now.toLocaleString('th-TH', options)
                    .replace(' ', ' ')
                    .replace(',', '');
                document.getElementById('datetime').textContent = dateTimeString;
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô updateDateTime:', error);
            }
        }

        updateDateTime();
        setInterval(updateDateTime, 1000);

        function showProgress() {
            try {
                const overlay = document.getElementById('progressOverlay');
                const progressBar = document.getElementById('progressBar');
                overlay.style.display = 'flex';
                let progress = 0;
                progressBar.style.width = '0%';
                progressBar.textContent = '0%';
                const interval = setInterval(() => {
                    progress += 10;
                    progressBar.style.width = `${progress}%`;
                    progressBar.textContent = `${progress}%`;
                    if (progress >= 100) {
                        clearInterval(interval);
                    }
                }, 100);
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô showProgress:', error);
            }
        }

        function hideProgress() {
            try {
                document.getElementById('progressOverlay').style.display = 'none';
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô hideProgress:', error);
            }
        }

        function flipCard() {
            try {
                const card = document.getElementById('card');
                card.classList.toggle('flipped');
                console.log('‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏•‡∏¥‡∏Å:', card.classList.contains('flipped') ? '‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á' : '‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤');
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô flipCard:', error);
            }
        }

        function showPopup(message) {
            try {
                document.getElementById('popupMessage').textContent = message;
                document.getElementById('popup').style.display = 'block';
                document.getElementById('popupOverlay').style.display = 'block';
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô showPopup:', error);
            }
        }

        function hidePopup() {
            try {
                document.getElementById('popup').style.display = 'none';
                document.getElementById('popupOverlay').style.display = 'none';
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô hidePopup:', error);
            }
        }

        function updateImagePreview() {
            try {
                const imageSelect = document.getElementById('imageSelect').value;
                const imagePreview = document.getElementById('imagePreview');
                imagePreview.innerHTML = '';
                if (imageSelect) {
                    const img = document.createElement('img');
                    img.src = imageSelect;
                    img.alt = '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û';
                    img.onerror = () => {
                        imagePreview.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</p>';
                    };
                    imagePreview.appendChild(img);
                } else {
                    imagePreview.innerHTML = '<p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</p>';
                }
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô updateImagePreview:', error);
            }
        }

        function showImagePopup() {
            try {
                const imageSelect = document.getElementById('imageSelect');
                imageSelect.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û --</option>';
                availableImages.forEach(image => {
                    const opt = document.createElement('option');
                    opt.value = image.value;
                    opt.textContent = image.text;
                    imageSelect.appendChild(opt);
                });
                if (currentImageUrl.startsWith('image/')) {
                    imageSelect.value = currentImageUrl;
                }
                document.getElementById('imageFile').value = '';
                const imagePreview = document.getElementById('imagePreview');
                imagePreview.innerHTML = '<p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</p>';
                document.getElementById('imagePopup').style.display = 'block';
                document.getElementById('imagePopupOverlay').style.display = 'block';
                updateImagePreview();
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô showImagePopup:', error);
            }
        }

        function hideImagePopup() {
            try {
                document.getElementById('imagePopup').style.display = 'none';
                document.getElementById('imagePopupOverlay').style.display = 'none';
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô hideImagePopup:', error);
            }
        }

        function changeImage() {
            try {
                const imageSelect = document.getElementById('imageSelect').value;
                const imageFile = document.getElementById('imageFile').files[0];

                if (imageFile) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageDataUrl = e.target.result;
                        if (imageDataUrl.startsWith('data:image/')) {
                            showProgress();
                            setTimeout(() => {
                                localStorage.setItem('currentImage', imageDataUrl);
                                currentImageUrl = imageDataUrl;
                                updateCardImage();
                                hideProgress();
                                hideImagePopup();
                                showPopup('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                            }, 1000);
                        } else {
                            showPopup('‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                        }
                    };
                    reader.onerror = () => {
                        showPopup('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏†‡∏≤‡∏û');
                    };
                    reader.readAsDataURL(imageFile);
                } else if (imageSelect) {
                    showProgress();
                    setTimeout(() => {
                        localStorage.setItem('currentImage', imageSelect);
                        currentImageUrl = imageSelect;
                        updateCardImage();
                        hideProgress();
                        hideImagePopup();
                        showPopup('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    }, 1000);
                } else {
                    showPopup('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå');
                }
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô changeImage:', error);
                showPopup('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û');
            }
        }

        function dataURLtoBlob(dataURL) {
            try {
                const arr = dataURL.split(',');
                const mime = arr[0].match(/:(.*?);/)[1];
                const bstr = atob(arr[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                while (n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                return new Blob([u8arr], { type: mime });
            } catch (error) {
                throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏õ‡∏•‡∏á Data URL ‡πÄ‡∏õ‡πá‡∏ô Blob: ' + error.message);
            }
        }

        function submitBlessing() {
            try {
                const botToken = localStorage.getItem('botToken');
                const chatId = localStorage.getItem('chatId');

                if (!botToken || !chatId) {
                    showPopup('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Bot Token ‡πÅ‡∏•‡∏∞ Chat ID ‡∏Å‡πà‡∏≠‡∏ô\n‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏î‡∏¢‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ü‡∏±‡∏ô‡πÄ‡∏ü‡∏∑‡∏≠‡∏á‡πÉ‡∏ô Navbar');
                    return;
                }

                const messageTypeSelect = document.getElementById('messageType');
                const messageTypeText = messageTypeSelect.options[messageTypeSelect.selectedIndex].text;
                const blessingSelect = document.getElementById('blessing');
                let blessingText = blessingSelect.options[blessingSelect.selectedIndex].text;

                if (blessingSelect.value === 'custom') {
                    blessingText = document.getElementById('customMessage').value.trim();
                    if (!blessingText) {
                        showPopup('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£');
                        return;
                    }
                }

                const firstName = document.getElementById('firstName').value;
                const lastName = document.getElementById('lastName').value;

                if (!firstName || !lastName) {
                    showPopup('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î');
                    return;
                }

                const message = `<b>üìú ${messageTypeText}</b>\n\n` +
                               `<b>‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£:</b> ${blessingText}\n` +
                               `<b>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•:</b> ${firstName}\n` +
                               `<b>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° :</b> ${lastName}\n` +
                               `\n<i>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</i> ${new Date().toLocaleString('th-TH')}`;

                const popupMessage = `üìú ${messageTypeText}\n\n` +
                                     `‡∏Ñ‡∏≥‡∏≠‡∏ß‡∏¢‡∏û‡∏£: ${blessingText}\n` +
                                     `‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•: ${firstName}\n` +
                                     `‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° : ${lastName}\n` +
                                     `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleString('th-TH')}`;

                showProgress();
                setTimeout(() => {
                    sendPhotoToTelegram()
                        .then(data => {
                            if (!data.ok) {
                                throw new Error(data.description);
                            }
                            return sendMessageToTelegram(message);
                        })
                        .then(data => {
                            hideProgress();
                            if (data.ok) {
                                showPopup(`${popupMessage}\n\n‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                            } else {
                                showPopup(`${popupMessage}\n\n‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏õ Telegram: ${data.description}`);
                            }
                            flipCard();
                        })
                        .catch(error => {
                            hideProgress();
                            showPopup(`${popupMessage}\n\n‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡πÑ‡∏õ Telegram: ${error.message}`);
                            flipCard();
                        });
                }, 1000);
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô submitBlessing:', error);
                showPopup('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°');
            }
        }

        function sendPhotoToTelegram() {
            try {
                const botToken = localStorage.getItem('botToken');
                const chatId = localStorage.getItem('chatId');
                const url = `https://api.telegram.org/bot${botToken}/sendPhoto`;

                if (currentImageUrl.startsWith('image/')) {
                    return fetch(currentImageUrl)
                        .then(response => {
                            if (!response.ok) throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å \image\');
                            return response.blob();
                        })
                        .then(blob => {
                            const formData = new FormData();
                            formData.append('chat_id', chatId);
                            formData.append('photo', blob, 'image.jpg');
                            return fetch(url, {
                                method: 'POST',
                                body: formData
                            }).then(response => response.json());
                        });
                } else {
                    const blob = dataURLtoBlob(currentImageUrl);
                    const formData = new FormData();
                    formData.append('chat_id', chatId);
                    formData.append('photo', blob, 'image.jpg');
                    return fetch(url, {
                        method: 'POST',
                        body: formData
                    }).then(response => response.json());
                }
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô sendPhotoToTelegram:', error);
                throw error;
            }
        }

        function sendMessageToTelegram(message) {
            try {
                const botToken = localStorage.getItem('botToken');
                const chatId = localStorage.getItem('chatId');
                const url = `https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}&parse_mode=HTML`;
                return fetch(url)
                    .then(response => response.json());
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô sendMessageToTelegram:', error);
                throw error;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            try {
                const flipButton = document.getElementById('flipButton');
                if (flipButton) {
                    flipButton.addEventListener('click', flipCard);
                    flipButton.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        flipCard();
                    });
                } else {
                    console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏∏‡πà‡∏° flipButton');
                }

                const confirmImageButton = document.getElementById('confirmImageButton');
                if (confirmImageButton) {
                    confirmImageButton.addEventListener('click', changeImage);
                    confirmImageButton.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        changeImage();
                    });
                } else {
                    console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏∏‡πà‡∏° confirmImageButton');
                }

                const imagePopupLink = document.getElementById('imagePopupLink');
                if (imagePopupLink) {
                    imagePopupLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        showImagePopup();
                    });
                } else {
                    console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö imagePopupLink');
                }

                const cardFront = document.getElementById('cardFront');
                if (cardFront) {
                    cardFront.addEventListener('touchstart', (e) => {
                        if (!e.target.closest('button')) {
                            e.preventDefault();
                            flipCard();
                        }
                    });
                } else {
                    console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö cardFront');
                }

                const imageFileInput = document.getElementById('imageFile');
                if (imageFileInput) {
                    imageFileInput.addEventListener('change', () => {
                        const file = imageFileInput.files[0];
                        const imagePreview = document.getElementById('imagePreview');
                        imagePreview.innerHTML = '';
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.alt = '‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î';
                                imagePreview.appendChild(img);
                            };
                            reader.onerror = () => {
                                imagePreview.innerHTML = '<p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ</p>';
                            };
                            reader.readAsDataURL(file);
                        } else {
                            imagePreview.innerHTML = '<p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</p>';
                        }
                    });
                } else {
                    console.error('‡πÑ‡∏°‡πà‡∏û‡∏ö imageFile input');
                }

                updateBlessingOptions();
            } catch (error) {
                console.error('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå:', error);
            }
        });
    </script>
</body>
</html>
